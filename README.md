 
  
     

<div id="article_content" class="article_content">

<h2><span style="color:#cc0000">广播 :</span><span style="color:rgb(51,51,51); font-family:verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:25.2px"><span style="font-weight:normal">在Android中，Broadcast是一种广泛运用的在应用程序之间传输信息的机制。我们拿广播电台来做个比方。我们平常使用收音机收音是这样的：许许多多不同的广播电台通过特定的频率来发送他们的内容，而我们用户只需要将频率调成和广播电台的一样就可以收听他们的内容了。Android中的广播机制就和这个差不多的道理,<span style="font-family:'Open Sans',Helvetica,Arial,sans-serif; font-size:14px; line-height:23.8px">Android广播分为两个方面：广播发送者和广播接收者，通常情况下，BroadcastReceiver指的就是广播接收者（广播接收器）。</span></span></span></h2>
<h2><span style="font-family:'Open Sans',Helvetica,Arial,sans-serif; font-size:14px; line-height:23.8px; color:rgb(51,51,51)">从实现原理看上，Android中的广播使用了观察者模式，基于消息的发布/订阅事件模型。因此，从实现的角度来看，Android中的广播将广播的发送者和接受者极大程度上解耦，使得系统能够方便集成，更易扩展。具体实现流程要点粗略概括如下：</span></h2>
<div><span style="font-family:verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:25.2px"><span style="font-family:'Open Sans',Helvetica,Arial,sans-serif; line-height:23.8px"></span></span>
<p style="color:rgb(51,51,51); margin:10px auto; padding-top:0px; padding-bottom:0px; font-family:'Open Sans',Helvetica,Arial,sans-serif; font-size:14px; line-height:23.8px">
<span style="margin:0px; padding:0px">1.广播接收者BroadcastReceiver通过Binder机制向AMS(Activity Manager Service)进行注册；</span></p>
<p style="color:rgb(51,51,51); margin:10px auto; padding-top:0px; padding-bottom:0px; font-family:'Open Sans',Helvetica,Arial,sans-serif; font-size:14px; line-height:23.8px">
<span style="margin:0px; padding:0px">2.广播发送者通过binder机制向AMS发送广播；</span></p>
<p style="color:rgb(51,51,51); margin:10px auto; padding-top:0px; padding-bottom:0px; font-family:'Open Sans',Helvetica,Arial,sans-serif; font-size:14px; line-height:23.8px">
<span style="margin:0px; padding:0px">3.AMS查找符合相应条件（IntentFilter/Permission等）的BroadcastReceiver，将广播发送到BroadcastReceiver（一般情况下是Activity）相应的消息循环队列中；</span></p>
<p style="color:rgb(51,51,51); margin:10px auto; padding-top:0px; padding-bottom:0px; font-family:'Open Sans',Helvetica,Arial,sans-serif; font-size:14px; line-height:23.8px">
<span style="margin:0px; padding:0px">4.消息循环执行拿到此广播，回调BroadcastReceiver中的onReceive()方法。</span></p>
<p style="color:rgb(51,51,51); margin:10px auto; padding-top:0px; padding-bottom:0px; font-family:'Open Sans',Helvetica,Arial,sans-serif; font-size:14px; line-height:23.8px">
<span style="margin:0px; padding:0px"><span style="color:rgb(51,51,51); font-family:verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:25.2px">现在我们就来实现一个简单的广播程序。Android提供了两种注册广播接受者的形式，分别是在程序中动态注册和在xml中指定。他们之间的区别就是作用的范围不同，程序动态注册的接收者只在程序运行过程中有效，而在xml注册的接收者不管你的程序有没有启动有会起作用。首先介绍在程序中动态注册的方式。</span><br>
</span></p>
<h3 style="margin:10px auto; padding-top:0px; padding-bottom:0px; font-family:'Open Sans',Helvetica,Arial,sans-serif; font-size:14px; line-height:23.8px">
<span style="margin:0px; padding:0px"><span style="font-family:verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:25.2px"><span style="margin:0px; padding:0px; font-family:verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:25.2px"><span style="margin:0px; padding:0px; line-height:1.8; font-size:14px"><span style="color:#ff0000">动态注册方式：</span></span></span></span></span></h3>
<pre style="margin-top:0px; margin-bottom:0px; padding:0px; white-space:pre-wrap; word-wrap:break-word; line-height:20.4px; font-family:'Courier New'!important"><span style="margin:0px; padding:0px; font-size:14px; line-height:1.5!important"><span style="margin:0px; padding:0px; color:rgb(0,0,255); font-size:12px!important; line-height:1.5!important">public</span> <span style="margin:0px; padding:0px; color:rgb(0,0,255); font-size:12px!important; line-height:1.5!important">class</span> MainActivity <span style="margin:0px; padding:0px; color:rgb(0,0,255); font-size:12px!important; line-height:1.5!important">extends</span><span style="margin:0px; padding:0px; font-size:12px!important; line-height:1.5!important"> Activity {
</span><span style="margin:0px; padding:0px; color:rgb(0,128,128); font-size:12px!important; line-height:1.5!important"> </span>     <span style="margin:0px; padding:0px; color:rgb(0,0,255); font-size:12px!important; line-height:1.5!important">public</span> <span style="margin:0px; padding:0px; color:rgb(0,0,255); font-size:12px!important; line-height:1.5!important">static</span> <span style="margin:0px; padding:0px; color:rgb(0,0,255); font-size:12px!important; line-height:1.5!important">final</span> String BROADCAST_ACTION = &quot;com.example.corn&quot;<span style="margin:0px; padding:0px; font-size:12px!important; line-height:1.5!important">;
</span><span style="margin:0px; padding:0px; color:rgb(0,128,128); font-size:12px!important; line-height:1.5!important"> </span>     <span style="margin:0px; padding:0px; color:rgb(0,0,255); font-size:12px!important; line-height:1.5!important">private</span><span style="margin:0px; padding:0px; font-size:12px!important; line-height:1.5!important"> BroadcastReceiver mBroadcastReceiver;
</span><span style="margin:0px; padding:0px; color:rgb(0,128,128); font-size:12px!important; line-height:1.5!important"> </span> 
<span style="margin:0px; padding:0px; color:rgb(0,128,128); font-size:12px!important; line-height:1.5!important"> </span> <span style="margin:0px; padding:0px; font-size:12px!important; line-height:1.5!important">    @Override
</span><span style="margin:0px; padding:0px; color:rgb(0,128,128); font-size:12px!important; line-height:1.5!important"> </span>     <span style="margin:0px; padding:0px; color:rgb(0,0,255); font-size:12px!important; line-height:1.5!important">protected</span> <span style="margin:0px; padding:0px; color:rgb(0,0,255); font-size:12px!important; line-height:1.5!important">void</span><span style="margin:0px; padding:0px; font-size:12px!important; line-height:1.5!important"> onCreate(Bundle savedInstanceState) {
</span><span style="margin:0px; padding:0px; color:rgb(0,128,128); font-size:12px!important; line-height:1.5!important"> </span>         <span style="margin:0px; padding:0px; color:rgb(0,0,255); font-size:12px!important; line-height:1.5!important">super</span><span style="margin:0px; padding:0px; font-size:12px!important; line-height:1.5!important">.onCreate(savedInstanceState);
</span><span style="margin:0px; padding:0px; color:rgb(0,128,128); font-size:12px!important; line-height:1.5!important"> </span> <span style="margin:0px; padding:0px; font-size:12px!important; line-height:1.5!important">        setContentView(R.layout.activity_main);
</span><span style="margin:0px; padding:0px; color:rgb(0,128,128); font-size:12px!important; line-height:1.5!important"> </span> 
         mBroadcastReceiver = <span style="margin:0px; padding:0px; color:rgb(0,0,255); font-size:12px!important; line-height:1.5!important">new</span><span style="margin:0px; padding:0px; font-size:12px!important; line-height:1.5!important"> MyBroadcastReceiver();
</span>         IntentFilter intentFilter = <span style="margin:0px; padding:0px; color:rgb(0,0,255); font-size:12px!important; line-height:1.5!important">new</span><span style="margin:0px; padding:0px; font-size:12px!important; line-height:1.5!important"> IntentFilter();
</span> <span style="margin:0px; padding:0px; font-size:12px!important; line-height:1.5!important">        intentFilter.addAction(BROADCAST_ACTION);
</span> <span style="margin:0px; padding:0px; font-size:12px!important; line-height:1.5!important">        registerReceiver(mBroadcastReceiver, intentFilter);
</span> <span style="margin:0px; padding:0px; font-size:12px!important; line-height:1.5!important">    }
</span>     
 <span style="margin:0px; padding:0px; font-size:12px!important; line-height:1.5!important">    @Override
</span>     <span style="margin:0px; padding:0px; color:rgb(0,0,255); font-size:12px!important; line-height:1.5!important">protected</span> <span style="margin:0px; padding:0px; color:rgb(0,0,255); font-size:12px!important; line-height:1.5!important">void</span><span style="margin:0px; padding:0px; font-size:12px!important; line-height:1.5!important"> onDestroy() {
</span>         <span style="margin:0px; padding:0px; color:rgb(0,0,255); font-size:12px!important; line-height:1.5!important">super</span><span style="margin:0px; padding:0px; font-size:12px!important; line-height:1.5!important">.onDestroy();
</span> <span style="margin:0px; padding:0px; font-size:12px!important; line-height:1.5!important">        unregisterReceiver(mBroadcastReceiver);
</span> <span style="margin:0px; padding:0px; font-size:12px!important; line-height:1.5!important">    }
</span> </span><pre style="margin-top:0px; margin-bottom:0px; padding:0px; white-space:pre-wrap; word-wrap:break-word; line-height:20.4px; font-family:'Courier New'!important"><span style="margin:0px; padding:0px; font-size:14px; line-height:1.5!important"><span style="margin:0px; padding:0px; color:rgb(0,0,255); font-size:12px!important; line-height:1.5!important">  class</span> MyBroadcastReceiver <span style="margin:0px; padding:0px; color:rgb(0,0,255); font-size:12px!important; line-height:1.5!important">extends</span><span style="margin:0px; padding:0px; font-size:12px!important; line-height:1.5!important"> BroadcastReceiver {
</span>
<span style="margin:0px; padding:0px; color:rgb(0,128,128); font-size:12px!important; line-height:1.5!important"> </span> <span style="margin:0px; padding:0px; font-size:12px!important; line-height:1.5!important">    @Override
</span><span style="margin:0px; padding:0px; color:rgb(0,128,128); font-size:12px!important; line-height:1.5!important"> </span>     <span style="margin:0px; padding:0px; color:rgb(0,0,255); font-size:12px!important; line-height:1.5!important">public</span> <span style="margin:0px; padding:0px; color:rgb(0,0,255); font-size:12px!important; line-height:1.5!important">void</span><span style="margin:0px; padding:0px; font-size:12px!important; line-height:1.5!important"> onReceive(Context context, Intent intent) {
</span><span style="margin:0px; padding:0px; color:rgb(0,128,128); font-size:12px!important; line-height:1.5!important"> </span>         if(null!=intent)<span style="margin:0px; padding:0px; font-size:12px!important; line-height:1.5!important">
</span><span style="margin:0px; padding:0px; color:rgb(0,128,128); font-size:12px!important; line-height:1.5!important"> </span>        Toast.makeText(context, &quot;广播接收到:&quot;, Toast.LENGTH_SHORT).show();&nbsp;<span style="margin:0px; padding:0px; font-size:12px!important; line-height:1.5!important"></span>
 <span style="margin:0px; padding:0px; font-size:12px!important; line-height:1.5!important">    }</span></span></pre> }</pre>
<span style="margin:0px; padding:0px; font-family:verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:25.2px"><span style="margin:0px; padding:0px; line-height:1.8; font-size:14px"><span style="color:#ff0000">配置文件方式:</span></span></span></div>
<div><span style="font-family:verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:25.2px"><span style="font-family:'Open Sans',Helvetica,Arial,sans-serif; line-height:23.8px"></span></span></div>
<pre style="margin-top:0px; margin-bottom:0px; font-size:14px; padding:0px; white-space:pre-wrap; word-wrap:break-word; line-height:20.4px; font-family:'Courier New'!important"><span style="margin:0px; padding:0px; line-height:1.5!important"><span style="margin:0px; padding:0px; color:rgb(0,0,255); font-size:12px!important; line-height:1.5!important">public</span> <span style="margin:0px; padding:0px; color:rgb(0,0,255); font-size:12px!important; line-height:1.5!important">class</span> MainActivity <span style="margin:0px; padding:0px; color:rgb(0,0,255); font-size:12px!important; line-height:1.5!important">extends</span><span style="margin:0px; padding:0px; font-size:12px!important; line-height:1.5!important"> Activity {</span><span style="margin:0px; padding:0px; font-size:12px!important; line-height:1.5!important">
</span><span style="margin:0px; padding:0px; color:rgb(0,128,128); font-size:12px!important; line-height:1.5!important"> </span>    <span style="margin:0px; padding:0px; font-size:12px!important; line-height:1.5!important">
</span><span style="margin:0px; padding:0px; color:rgb(0,128,128); font-size:12px!important; line-height:1.5!important"> </span> 
<span style="margin:0px; padding:0px; color:rgb(0,128,128); font-size:12px!important; line-height:1.5!important"> </span> <span style="margin:0px; padding:0px; font-size:12px!important; line-height:1.5!important">    @Override
</span><span style="margin:0px; padding:0px; color:rgb(0,128,128); font-size:12px!important; line-height:1.5!important"> </span>     <span style="margin:0px; padding:0px; color:rgb(0,0,255); font-size:12px!important; line-height:1.5!important">protected</span> <span style="margin:0px; padding:0px; color:rgb(0,0,255); font-size:12px!important; line-height:1.5!important">void</span><span style="margin:0px; padding:0px; font-size:12px!important; line-height:1.5!important"> onCreate(Bundle savedInstanceState) {
</span><span style="margin:0px; padding:0px; color:rgb(0,128,128); font-size:12px!important; line-height:1.5!important"> </span>         <span style="margin:0px; padding:0px; color:rgb(0,0,255); font-size:12px!important; line-height:1.5!important">super</span><span style="margin:0px; padding:0px; font-size:12px!important; line-height:1.5!important">.onCreate(savedInstanceState);
</span><span style="margin:0px; padding:0px; color:rgb(0,128,128); font-size:12px!important; line-height:1.5!important"> </span> <span style="margin:0px; padding:0px; font-size:12px!important; line-height:1.5!important">        setContentView(R.layout.activity_main);
</span><span style="margin:0px; padding:0px; color:rgb(0,128,128); font-size:12px!important; line-height:1.5!important"> </span> <span style="white-space:pre">	</span>Intent intent = new Intent(); &nbsp;
<span style="white-space:pre">	</span>intent.setAction(&quot;com.xiazdong&quot;); &nbsp;
<span style="white-space:pre">	</span></span><span style="line-height:1.5">intent.putExtra(&quot;name&quot;, &quot;xiazdong&quot;); &nbsp;</span></pre>
<pre style="margin-top:0px; margin-bottom:0px; font-size:14px; padding:0px; white-space:pre-wrap; word-wrap:break-word; line-height:20.4px; font-family:'Courier New'!important"><span style="margin:0px; padding:0px; line-height:1.5!important"><span style="white-space:pre">	</span><span style="margin:0px; padding:0px; line-height:1.5!important">MainActivity </span><span style="line-height:1.5">.this.sendBroadcast(intent); &nbsp;</span><span style="white-space:pre">
</span> <span style="margin:0px; padding:0px; font-size:12px!important; line-height:1.5!important">    }
</span>     
 <span style="margin:0px; padding:0px; font-size:12px!important; line-height:1.5!important"> </span></span><pre style="margin-top:0px; margin-bottom:0px; font-size:14px; padding:0px; white-space:pre-wrap; word-wrap:break-word; line-height:20.4px; font-family:'Courier New'!important">}</pre>  <br><pre style="margin-top:0px; margin-bottom:0px; padding:0px; white-space:pre-wrap; word-wrap:break-word; line-height:20.4px; font-family:'Courier New'!important"><span style="margin:0px; padding:0px; line-height:1.5!important"><span style="margin:0px; padding:0px; color:rgb(0,0,255); font-size:12px!important; line-height:1.5!important"> public class</span> MyReceiver <span style="margin:0px; padding:0px; color:rgb(0,0,255); font-size:12px!important; line-height:1.5!important">extends</span><span style="margin:0px; padding:0px; font-size:12px!important; line-height:1.5!important"> BroadcastReceiver {
</span><span style="margin:0px; padding:0px; color:rgb(0,128,128); font-size:12px!important; line-height:1.5!important"> </span>    <span style="margin:0px; padding:0px; color:rgb(0,128,128); font-size:12px!important; line-height:1.5!important"> </span> 
<span style="margin:0px; padding:0px; color:rgb(0,128,128); font-size:12px!important; line-height:1.5!important"> </span> <span style="margin:0px; padding:0px; font-size:12px!important; line-height:1.5!important">    @Override
</span><span style="margin:0px; padding:0px; color:rgb(0,128,128); font-size:12px!important; line-height:1.5!important"> </span>     <span style="margin:0px; padding:0px; color:rgb(0,0,255); font-size:12px!important; line-height:1.5!important">public</span> <span style="margin:0px; padding:0px; color:rgb(0,0,255); font-size:12px!important; line-height:1.5!important">void</span><span style="margin:0px; padding:0px; font-size:12px!important; line-height:1.5!important"> onReceive(Context context, Intent intent) {
</span><span style="margin:0px; padding:0px; color:rgb(0,128,128); font-size:12px!important; line-height:1.5!important"> </span>         if(null!=intent){<span style="margin:0px; padding:0px; font-size:12px!important; line-height:1.5!important">
</span><span style="margin:0px; padding:0px; color:rgb(0,128,128); font-size:12px!important; line-height:1.5!important"> </span>       <span style="white-space:pre">		</span>&nbsp;String name = intent.getExtras().getString(&quot;name&quot;); &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; <span style="white-space:pre">	</span>&nbsp;Toast.makeText(context, &quot;广播接收到:&quot;&#43;name, Toast.LENGTH_SHORT).show(); &nbsp;</span></pre><pre style="margin-top:0px; margin-bottom:0px; padding:0px; white-space:pre-wrap; word-wrap:break-word; line-height:20.4px; font-family:'Courier New'!important"><span style="margin:0px; padding:0px; line-height:1.5!important"><span style="white-space:pre">	</span>}
 <span style="margin:0px; padding:0px; font-size:12px!important; line-height:1.5!important">    }</span></span></pre> }</pre>
<pre style="margin-top:0px; margin-bottom:0px; font-size:14px; padding:0px; white-space:pre-wrap; word-wrap:break-word; line-height:20.4px; font-family:'Courier New'!important">
</pre>
<pre style="margin-top:0px; margin-bottom:0px; font-size:14px; padding:0px; white-space:pre-wrap; word-wrap:break-word; line-height:20.4px; font-family:'Courier New'!important">AndroidManiFest.xml 的 &lt;application&gt;中添加</pre>
<pre style="margin-top:0px; margin-bottom:0px; font-size:14px; padding:0px; white-space:pre-wrap; word-wrap:break-word; line-height:20.4px; font-family:'Courier New'!important">&nbsp; &lt;receiver android:name=&quot;.MyReceiver&quot;&gt; &nbsp;
&nbsp; &nbsp; &nbsp;<span style="white-space:pre">		</span> &lt;intent-filter android:priority=&quot;1000&quot;&gt; &lt;!-- 设置最高优先级 --&gt; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; <span style="white-space:pre">		</span>&lt;action android:name=&quot;com.xiazdong&quot;/&gt; &nbsp;
&nbsp; &nbsp; &nbsp; <span style="white-space:pre">		</span>&lt;/intent-filter&gt; &nbsp;
 &lt;/receiver&gt; &nbsp;
</pre>
  
</div>
